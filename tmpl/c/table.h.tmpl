#pragma once

/* ********************** start of generic functions *********************** */

#define SetColumn(tbl, col, value) \
	tbl.col = &tbl.impl.col; \
	tbl.impl.col = value;
	
/* ********************** end of generic functions ************************* */
{{ with .Databases }}{{ range . }}{{ with .Tables }}{{ range . }}
/* ********************** table {{ .Name }} ************************* */

typedef struct _{{ .Name }}Impl { {{ with .Columns }}{{ range . }}
	{{ .DataType }} {{ .Name }};{{ end }}{{ end }}{{/* columns */}}
} {{ .Name }}Impl;

typedef struct _{{ .Name }} { {{ with .Columns }}{{ range . }}
	{{ .DataType }}* {{ .Name }};{{ end }}{{ end }}{{/* columns */}}
	{{ .Name }}Impl impl;
} {{ .Name }};

void _create_{{ .Name }}({{ .Name }}* tbl);

#define create_{{ .Name }}(var) \
	{{ .Name }} var;\
	_create_{{ .Name }}(&var);
	
#define alloc_{{ .Name }}(var) \
	{{ .Name }}* var = malloc(); \
	_create_{{ .Name }}(var);

{{ end }}{{ end }}{{/* tables */}}{{ end }}{{ end }}{{/* databases */}}